<!doctype html>
<html lang="ru" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UUID Converter</title>

  <!-- Early apply theme + accent (no flicker) -->
  <script>
    (function(){
      const APP_VERSION = '1.2.29';
      window.APP_VERSION = APP_VERSION;

      function hexToRgb(hex){
        hex = String(hex || '').replace('#','');
        if(hex.length === 3) hex = hex.split('').map(ch=>ch+ch).join('');
        const bigint = parseInt(hex,16) || 0;
        return { r: (bigint>>16)&255, g: (bigint>>8)&255, b: bigint&255 };
      }
      function rgbToHex(r,g,b){
        const toHex = n => ('0'+Math.round(n).toString(16)).slice(-2);
        return '#' + toHex(r) + toHex(g) + toHex(b);
      }
      function rgbToHsl(r,g,b){
        r/=255; g/=255; b/=255;
        const max = Math.max(r,g,b), min = Math.min(r,g,b);
        let h=0, s=0, l=(max+min)/2;
        if(max!==min){
          const d = max-min;
          s = l>0.5 ? d/(2-max-min) : d/(max+min);
          switch(max){
            case r: h = (g-b)/d + (g<b?6:0); break;
            case g: h = (b-r)/d + 2; break;
            case b: h = (r-g)/d + 4; break;
          }
          h /= 6;
        }
        return { h: h*360, s: s*100, l: l*100 };
      }
      function hslToRgb(h,s,l){
        h/=360; s/=100; l/=100;
        if(s===0){ const v = Math.round(l*255); return { r:v,g:v,b:v }; }
        function hue2rgb(p,q,t){
          if(t<0) t+=1; if(t>1) t-=1;
          if(t<1/6) return p+(q-p)*6*t;
          if(t<1/2) return q;
          if(t<2/3) return p+(q-p)*(2/3-t)*6;
          return p;
        }
        const q = l<0.5 ? l*(1+s) : l+s - l*s;
        const p = 2*l - q;
        const r = hue2rgb(p,q,h+1/3);
        const g = hue2rgb(p,q,h);
        const b = hue2rgb(p,q,h-1/3);
        return { r: Math.round(r*255), g: Math.round(g*255), b: Math.round(b*255) };
      }
      function darkenHex(hex, amountPercent=18){
        const {r,g,b} = hexToRgb(hex);
        const hsl = rgbToHsl(r,g,b);
        hsl.l = Math.max(0, hsl.l - amountPercent);
        const rgb = hslToRgb(hsl.h,hsl.s,hsl.l);
        return rgbToHex(rgb.r,rgb.g,rgb.b);
      }

      try{
        const raw = localStorage.getItem('uuid_converter_prefs');
        if(raw){
          const p = JSON.parse(raw);
          if(p && p.theme) document.documentElement.setAttribute('data-theme', p.theme);

          if(p && p.accent){
            const hex = String(p.accent).trim();
            const darker = darkenHex(hex, 18);
            const rgb = hexToRgb(hex);
            document.documentElement.style.setProperty('--accent', hex);
            document.documentElement.style.setProperty('--accent-600', darker);
            document.documentElement.style.setProperty('--accent-r', rgb.r);
            document.documentElement.style.setProperty('--accent-g', rgb.g);
            document.documentElement.style.setProperty('--accent-b', rgb.b);
          }
        }
      }catch(e){}
    })();
  </script>

  <link rel="stylesheet" href="style.css?v=1.2.29" />
  <link rel="icon" href="favicon.jpg" />
</head>
<body>
  <div id="loader" aria-hidden="true">
    <div class="dots-container" aria-hidden="true">
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>
  </div>

  <div class="app-shell container">
    <header class="site-header" role="banner">
      <div class="header-left">
        <h1 class="title">UUID Converter</h1>
      </div>

      <nav class="header-controls" role="navigation" aria-label="Настройки интерфейса">
        <div class="palette-control" id="paletteControl" aria-label="Палитра акцента">
          <button class="icon-btn" id="paletteToggle" aria-haspopup="true" aria-expanded="false" aria-label="Открыть палитру акцента">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M12 3C7 3 4 6 4 11c0 5 4 8 8 8s8-3 8-8c0-5-3-8-8-8z" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>

          <div class="palette-popover" id="palettePopover" aria-hidden="true" aria-label="Выбор цвета акцента">
            <div class="palette-presets" id="palettePresets" aria-hidden="false"></div>

            <label class="palette-custom">
              <input type="color" id="paletteColor" value="#2b7be4" aria-label="Выбрать свой цвет акцента">
              <span class="small">Свой цвет</span>
            </label>

            <div class="palette-actions">
              <button id="paletteReset" class="ghost small" type="button" aria-label="Сбросить цвет">Сбросить</button>
            </div>
          </div>
        </div>

        <button id="themeToggle" class="icon-btn" aria-pressed="false" aria-label="Переключить тему (светлая / тёмная)">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 3v2M12 19v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M3 12h2M19 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.2" fill="none"/>
          </svg>
        </button>
<button id="hotkeysBtn" class="icon-btn" aria-haspopup="dialog" aria-expanded="false" aria-controls="hotkeysModal" aria-label="Справка по горячим клавишам">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 2v20M2 12h20" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </nav>
    </header>

    <div id="updateNotice" class="update-notice" style="display:none" aria-live="polite"></div>

    <main class="panel" id="mainPanel" role="main" aria-labelledby="mainTitle">
      <h2 id="mainTitle" class="visually-hidden">Главная панель конвертера</h2>

      <div class="tabs" role="tablist" aria-label="Режимы">
        <button class="tab-btn active" id="tabUuid" role="tab" aria-selected="true" aria-controls="panelUuid" tabindex="0" type="button">
          <span class="tab-icon" aria-hidden="true">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M4 7h16M4 12h16M4 17h10" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
          </span>
          Конвертер
        </button>
        <button class="tab-btn" id="tabTree" role="tab" aria-selected="false" aria-controls="panelTree" tabindex="-1" type="button" aria-label="Конвертер слотов">
          <span class="tab-icon" aria-hidden="true">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
              <path d="M12 2v3" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
              <path d="M12 5l-6 7h4l-5 6h14l-5-6h4l-6-7z" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/>
              <path d="M12 18v4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
            </svg>
          </span>
          НГ
        </button>
      </div>

      <div id="panelUuid" class="tab-panel active" role="tabpanel" aria-labelledby="tabUuid">
        <section class="block input-block" aria-labelledby="inputLabel">
          <label id="inputLabel" class="small field-label" for="input">Поле для ввода</label>
          <div class="textarea-wrap">
        <textarea id="input" name="input" placeholder="Введите строки..." aria-label="Ввод строк для конвертации" spellcheck="false" autocomplete="off" class="with-counter"></textarea>
        <div class="line-count" id="inputLineCount" aria-hidden="true">Кол-во строк: 0</div>
      </div>
        </section>

        <section class="block output-block" aria-labelledby="outputLabel">
          <label id="outputLabel" class="small field-label" for="output">Результат</label>
          <textarea id="output" name="output" readonly placeholder="Здесь появится результат..." aria-label="Результат конвертации" spellcheck="false"></textarea>

          <div class="controls-row" role="region" aria-label="Панель управления">
            <div class="controls-left">
              <button id="clear" type="button" class="ghost btn-animate" aria-label="Очистить поля">
                <span class="btn-icon" aria-hidden="true">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M3 6h18" stroke="currentColor" stroke-width="1.4"/><path d="M8 6v12a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6" stroke="currentColor" stroke-width="1.4"/></svg>
                </span>
                Очистить
              </button>
            </div>

            <div class="controls-right controls-nowrap">
              <button id="convert" type="button" class="btn-animate" data-tooltip="Ctrl/Cmd + Enter" aria-keyshortcuts="Ctrl+Enter" aria-label="Конвертировать">
                <span class="btn-icon" aria-hidden="true">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M21 12a9 9 0 10-9 9" stroke="currentColor" stroke-width="1.4"/><path d="M21 3v6h-6" stroke="currentColor" stroke-width="1.4"/></svg>
                </span>
                Конвертировать
              </button>

              <button id="historyBtn" type="button" class="ghost floating btn-animate" aria-label="Открыть историю" aria-controls="historyModal">
                <span class="btn-icon" aria-hidden="true">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M21 12a9 9 0 11-2.9-6.3" stroke="currentColor" stroke-width="1.4"/><path d="M12 7v5l3 3" stroke="currentColor" stroke-width="1.4"/></svg>
                </span>
                История
                <span class="badge" id="historyCount" aria-hidden="true">0</span>
              </button>

              <button id="copy" type="button" class="ghost btn-animate" aria-label="Копировать результат">
                <span class="btn-icon" id="copyIcon" aria-hidden="true">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M16 4h-2a2 2 0 0 0-4 0H8a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z" stroke="currentColor" stroke-width="1.4"/></svg>
                </span>
                <span class="copy-label">Копировать</span>
              </button>
            </div>
          </div>
        </section>
      </div>

      <div id="panelTree" class="tab-panel" role="tabpanel" aria-labelledby="tabTree" hidden>
<section class="block">
          <label class="small field-label" for="treeAction">Действие</label>
          <select id="treeAction" class="select" aria-label="Выберите действие">
            <option value="disable">Выключить</option>
            <option value="enable">Включить</option>
          </select>
</section>

        <section class="block" id="treeDayWrap">
          <label class="small field-label" for="treeDayDate">Дата (МСК)</label>
          <input id="treeDayDate" class="text-input" type="date"
                 aria-label="Дата (МСК)"
                 min="2000-01-01" max="2100-12-31" />
        </section>

        <section class="block grid-2" id="treeRangeWrap">
          <div>
            <label class="small field-label" for="treeFromDT">С (МСК)</label>
            <input id="treeFromDT" class="text-input" type="datetime-local"
                   aria-label="Начало периода (МСК)"
                   step="60"
                   min="2000-01-01T00:00" max="2100-12-31T23:59" />
          </div>

          <div id="treeToWrap">
            <label class="small field-label" for="treeToDT">По (МСК)</label>
            <input id="treeToDT" class="text-input" type="datetime-local"
                   aria-label="Конец периода (МСК)"
                   step="60"
                   min="2000-01-01T00:00" max="2100-12-31T23:59" />
          </div>
        </section>

        <div class="quick-row" aria-label="Быстрые действия по времени">
          <button id="treeNow" type="button" class="ghost small">Сейчас</button>
        </div>

        <section class="block">
          <label class="small field-label" for="treeToken">access_token</label>
          <input id="treeToken" class="text-input" type="text" placeholder="secret_access_token" aria-label="access_token" autocomplete="off" />
        </section>

        <section class="block">
          <label class="small field-label" for="treeUuids">store_uuids</label>
          <div class="textarea-wrap">
        <textarea id="treeUuids" placeholder="Введите строки..." aria-label="Список store_uuids" spellcheck="false" class="with-counter"></textarea>
        <div class="line-count" id="treeUuidsLineCount" aria-hidden="true">Кол-во строк: 0</div>
      </div>
        </section>

        <section class="block">
          <label class="small field-label" for="treeOutput">Результат</label>
          <textarea id="treeOutput" readonly placeholder="Здесь появится результат..." aria-label="Результат JSON" spellcheck="false"></textarea>

          <div class="controls-row" role="region" aria-label="Панель управления ёлочки">
            <div class="controls-left">
              <button id="treeClear" type="button" class="ghost btn-animate" aria-label="Очистить поля ёлочки">
                <span class="btn-icon" aria-hidden="true">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M3 6h18" stroke="currentColor" stroke-width="1.4"/><path d="M8 6v12a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6" stroke="currentColor" stroke-width="1.4"/></svg>
                </span>
                Очистить
              </button>
            </div>
            <div class="controls-right controls-nowrap">
              <button id="treeBuild" type="button" class="btn-animate" aria-label="Конвертировать">
                <span class="btn-icon" aria-hidden="true">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M21 12a9 9 0 10-9 9" stroke="currentColor" stroke-width="1.4"/><path d="M21 3v6h-6" stroke="currentColor" stroke-width="1.4"/></svg>
                </span>
                Конвертировать
              </button>

              <button id="treeHistoryBtn" type="button" class="ghost btn-animate" aria-label="Открыть историю НГ" aria-controls="treeHistoryModal">
                <span class="btn-icon" aria-hidden="true">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M21 12a9 9 0 11-2.9-6.3" stroke="currentColor" stroke-width="1.4"/><path d="M12 7v5l3 3" stroke="currentColor" stroke-width="1.4"/></svg>
                </span>
                История
                <span class="badge" id="treeHistoryCount" aria-hidden="true">0</span>
              </button>

              <button id="treeCopy" type="button" class="ghost btn-animate" aria-label="Копировать JSON">
                <span class="btn-icon" aria-hidden="true">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M16 4h-2a2 2 0 0 0-4 0H8a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z" stroke="currentColor" stroke-width="1.4"/></svg>
                </span>
                Копировать
              </button>
            </div>
          </div>
        </section>
      </div>
    </main>

    <footer class="site-footer" role="contentinfo">
      <p class="footersmall">Локальная история хранится в LocalStorage. Данные не отправляются на сервер.</p>
      <p id="appVersion" class="footersmall3" aria-live="polite">Версия: —</p>
    </footer>
  </div>

  <div id="updateToastRoot" aria-live="polite" aria-atomic="true"></div>
  <div id="appToastRoot" aria-live="polite" aria-atomic="true"></div>

  <!-- HISTORY MODAL -->
  <div class="modal animated" id="historyModal" role="dialog" aria-modal="true" aria-labelledby="historyTitle" aria-hidden="true">
    <div class="modal-content" role="document">
      <div class="modal-header">
        <h2 id="historyTitle">История</h2>
        <div class="modal-actions">
          <button id="exportHistoryBtn" type="button" class="ghost" aria-label="Экспорт истории">Экспорт</button>
          <button id="clearHistoryBtn" type="button" class="ghost" aria-label="Очистить историю">Очистить</button>
          <button class="close" id="closeHistory" aria-label="Закрыть историю">×</button>
        </div>
      </div>
<div class="history-list" id="historyContent" aria-live="polite">Нет записей</div>
    </div>
  </div>

  
  <!-- TREE HISTORY MODAL -->
  <div class="modal animated" id="treeHistoryModal" role="dialog" aria-modal="true" aria-labelledby="treeHistoryTitle" aria-hidden="true">
    <div class="modal-content" role="document">
      <div class="modal-header">
        <h2 id="treeHistoryTitle">История НГ</h2>
        <div class="modal-actions">
          <button id="clearTreeHistoryBtn" type="button" class="ghost" aria-label="Очистить историю НГ">Очистить</button>
          <button class="close" id="closeTreeHistory" aria-label="Закрыть историю НГ">×</button>
        </div>
      </div>

      <div class="tiny muted-hint">История хранится локально (LocalStorage).</div>
      <div class="history-list" id="treeHistoryContent" aria-live="polite">Нет записей</div>
    </div>
  </div>

<!-- HOTKEYS MODAL -->
  <div class="modal animated" id="hotkeysModal" role="dialog" aria-modal="true" aria-labelledby="hotkeysTitle" aria-hidden="true">
    <div class="modal-content" role="document">
      <div class="modal-header">
        <h2 id="hotkeysTitle">Горячие клавиши</h2>
        <div class="modal-actions">
          <button class="close" id="closeHotkeys" aria-label="Закрыть справку">×</button>
        </div>
      </div>

      <ul class="hotkeys-list">
        <li><strong>Ctrl / ⌘ + Enter</strong> — Конвертировать</li>
        <li><strong>Esc</strong> — Закрыть модальные окна / палитру</li>
      </ul>
      <div class="small muted">Поддерживаются Ctrl (Windows/Linux) и ⌘ (Mac).</div>
    </div>
  </div>
  

  <!-- CONFIRM MODAL (custom confirm вместо browser alert/confirm) -->
  <div class="modal animated" id="confirmModal" role="dialog" aria-modal="true" aria-labelledby="confirmTitle" aria-hidden="true">
    <div class="modal-content" role="document" style="width:520px; max-width:100%;">
      <div class="modal-header">
        <h2 id="confirmTitle">Подтверждение</h2>
        <div class="modal-actions">
          <button class="close" id="confirmClose" aria-label="Закрыть">×</button>
        </div>
      </div>

      <div id="confirmMessage" class="small" style="margin:4px 0 10px;">Вы уверены?</div>

      <div class="modal-actions" style="justify-content:flex-end; margin-top:6px;">
        <button id="confirmCancel" type="button" class="ghost">Отмена</button>
        <button id="confirmOk" type="button">Ок</button>
      </div>
    </div>
  </div>

<script src="app.js?v=1.2.29" defer></script>
</body>
</html>
