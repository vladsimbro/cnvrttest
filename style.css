/* style.css (UI/UX only) */

:root{
  /* Layout */
  --max-width: 980px;
  --space-1: 6px;
  --space-2: 10px;
  --space-3: 14px;
  --space-4: 18px;
  --space-5: 22px;
  --radius-sm: 12px;
  --radius-md: 14px;
  --radius-lg: 18px;
  --radius-xl: 22px;

  /* Type */
  --ui: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Segoe UI Mono", monospace;
  --fs-12: 12px;
  --fs-13: 13px;
  --fs-14: 14px;
  --fs-15: 15px;
  --fs-18: 18px;
  --fs-20: 20px;

  /* Accent (is also set dynamically in index.html) */
  --accent: #2b7be4;
  --accent-600: #1a5fc1;

  /* Light theme palette */
  --bg: #eef1f4;
  --text: #121a24;
  --muted: rgba(18,26,36,0.66);
  --muted-strong: rgba(18,26,36,0.78);

  /* Glass surfaces */
  --glass-blur: 10px;
  --glass-tint: rgba(255,255,255,0.66);
  --glass-tint-2: rgba(255,255,255,0.78);
  --glass-tint-3: rgba(255,255,255,0.54);

  --border: rgba(9,16,24,0.10);
  --border-strong: rgba(9,16,24,0.14);
  --divider: rgba(9,16,24,0.06);

  /* Inputs */
  --field-bg: rgba(255,255,255,0.70);
  --field-bg-2: rgba(255,255,255,0.82);

  /* Shadows */
  --shadow-1: 0 10px 24px rgba(2,8,20,0.06);
  --shadow-2: 0 22px 56px rgba(2,8,20,0.10);
  --shadow-3: 0 44px 120px rgba(2,8,20,0.16);

  /* Rings */
  --ring: rgba(var(--accent-r,43),var(--accent-g,123),var(--accent-b,228),0.50);
  --ring-soft: rgba(var(--accent-r,43),var(--accent-g,123),var(--accent-b,228),0.18);

  /* Scrollbars */
  --scroll-thumb: rgba(9,16,24,0.22);
  --scroll-thumb-hover: rgba(9,16,24,0.32);
  --scroll-track: rgba(9,16,24,0.06);

  /* Motion */
  --ease-out: cubic-bezier(.2,.9,.2,1);
  --dur-1: 120ms;
  --dur-2: 180ms;
  --dur-3: 260ms;
  --dur-4: 360ms;

  color-scheme: light;
}

:root[data-theme="dark"], html[data-theme="dark"]{
  color-scheme: dark;

  --bg: #0b0d12;
  --text: rgba(240,246,255,0.92);
  --muted: rgba(240,246,255,0.62);
  --muted-strong: rgba(240,246,255,0.72);

  --glass-blur: 14px;
  --glass-tint: rgba(18,22,30,0.56);
  --glass-tint-2: rgba(18,22,30,0.72);
  --glass-tint-3: rgba(18,22,30,0.46);

  --border: rgba(255,255,255,0.10);
  --border-strong: rgba(255,255,255,0.14);
  --divider: rgba(255,255,255,0.06);

  --field-bg: rgba(16,20,28,0.62);
  --field-bg-2: rgba(16,20,28,0.74);

  --shadow-1: 0 16px 36px rgba(0,0,0,0.38);
  --shadow-2: 0 30px 80px rgba(0,0,0,0.52);
  --shadow-3: 0 64px 160px rgba(0,0,0,0.64);

  --scroll-thumb: rgba(255,255,255,0.18);
  --scroll-thumb-hover: rgba(255,255,255,0.26);
  --scroll-track: rgba(255,255,255,0.06);
}

/* Base */
*{ box-sizing:border-box; }
html,body{ height:100%; }
html, body{ overflow-x:hidden; }

body{
  margin:0;
  font-family: var(--ui);
  font-size: var(--fs-15);
  line-height: 1.5;
  color: var(--text);
  background: var(--bg);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;

  /* Mobile-first spacing (desktop upgrades below) */
  padding:
    calc(12px + env(safe-area-inset-top))
    calc(12px + env(safe-area-inset-right))
    calc(12px + env(safe-area-inset-bottom))
    calc(12px + env(safe-area-inset-left));

  transition: background var(--dur-4) ease, color var(--dur-4) ease;
  position:relative;
  isolation:isolate;
}

/* Ambient background blobs + soft noise */
body::before{
  content:"";
  position:fixed;
  inset:-20vmax;
  z-index:-1;
  pointer-events:none;
  background:
    radial-gradient(42vmax 30vmax at 15% 18%, rgba(var(--accent-r,43),var(--accent-g,123),var(--accent-b,228),0.22), transparent 70%),
    radial-gradient(38vmax 32vmax at 85% 22%, rgba(116, 210, 255, 0.16), transparent 72%),
    radial-gradient(42vmax 36vmax at 60% 92%, rgba(255, 197, 110, 0.14), transparent 75%),
    radial-gradient(40vmax 34vmax at 12% 88%, rgba(124, 92, 255, 0.14), transparent 74%);
  filter: blur(28px);
  opacity: 0.95;
}

:root[data-theme="dark"] body::before{
  background:
    radial-gradient(46vmax 34vmax at 16% 18%, rgba(var(--accent-r,43),var(--accent-g,123),var(--accent-b,228),0.20), transparent 72%),
    radial-gradient(42vmax 34vmax at 86% 22%, rgba(132, 187, 255, 0.10), transparent 74%),
    radial-gradient(46vmax 40vmax at 60% 92%, rgba(255, 180, 120, 0.08), transparent 76%),
    radial-gradient(44vmax 38vmax at 10% 88%, rgba(140, 110, 255, 0.10), transparent 76%);
  filter: blur(32px);
  opacity: 0.9;
}

body::after{
  content:"";
  position:fixed;
  inset:0;
  z-index:-1;
  pointer-events:none;
  background-image:
    radial-gradient(circle at 1px 1px, rgba(255,255,255,0.16) 1px, transparent 1px);
  background-size: 22px 22px;
  opacity: 0.12;
  mix-blend-mode: overlay;
}
:root[data-theme="dark"] body::after{
  background-image:
    radial-gradient(circle at 1px 1px, rgba(255,255,255,0.10) 1px, transparent 1px);
  opacity: 0.10;
}

.visually-hidden{
  position:absolute !important;
  height:1px;
  width:1px;
  overflow:hidden;
  clip:rect(1px,1px,1px,1px);
  white-space:nowrap;
}

:focus:not(:focus-visible){ outline:none; }
:focus-visible{
  outline: 2px solid var(--ring);
  outline-offset: 2px;
  border-radius: 10px;
}

.container{ max-width: var(--max-width); margin:0 auto; }

.app-shell{
  display:flex;
  flex-direction:column;
  gap: 12px;
}

/* Header */
.site-header{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap: 12px;
}

.title{
  margin:0;
  font-size: var(--fs-20);
  font-weight: 780;
  letter-spacing: -0.012em;
}

.header-controls{
  display:flex;
  align-items:center;
  gap: 10px;
  position:relative;
}

.icon-btn{
  appearance:none;
  border:none;
  cursor:pointer;
  color: var(--text);
  border-radius: 14px;
  padding: 10px;
  display:inline-flex;
  align-items:center;
  justify-content:center;

  background: linear-gradient(180deg, rgba(255,255,255,0.28), rgba(255,255,255,0.10));
  border: 1px solid var(--border);
  box-shadow: var(--shadow-1);

  -webkit-backdrop-filter: blur(var(--glass-blur));
  backdrop-filter: blur(var(--glass-blur));

  transition:
    transform var(--dur-2) var(--ease-out),
    box-shadow var(--dur-2) ease,
    background var(--dur-3) ease,
    border-color var(--dur-3) ease;
}

:root[data-theme="dark"] .icon-btn{
  background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06));
}

@media (hover:hover) and (pointer:fine){
  .icon-btn:hover{
    transform: translateY(-1px);
    box-shadow: var(--shadow-2);
    border-color: var(--border-strong);
  }
}

.icon-btn:active{ transform: translateY(0); }

/* Palette */
.palette-control{ position:relative; }
.palette-popover{
  display:none;
  position:absolute;
  right:0;
  margin-top: 10px;
  width: min(360px, calc(100vw - 24px));

  background: var(--glass-tint-2);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 12px;

  -webkit-backdrop-filter: blur(var(--glass-blur));
  backdrop-filter: blur(var(--glass-blur));
  box-shadow: var(--shadow-3);
}

.palette-popover.open{ display:block; }

.palette-presets{
  display:flex;
  gap: 10px;
  flex-wrap:wrap;
  margin-bottom: 10px;
}

.swatch{
  width: 30px;
  height: 30px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.22);
  cursor:pointer;
  padding:0;
  box-shadow: 0 10px 20px rgba(0,0,0,0.10);
}

:root:not([data-theme="dark"]) .swatch{ border-color: rgba(9,16,24,0.12); }

.swatch.active{
  transform: translateY(-1px) scale(1.02);
  box-shadow: 0 14px 26px rgba(0,0,0,0.18);
  outline: 3px solid rgba(var(--accent-r,43),var(--accent-g,123),var(--accent-b,228),0.20);
  outline-offset: 2px;
}

.palette-custom{
  display:flex;
  gap: 10px;
  align-items:center;
}

.palette-custom input[type="color"]{
  width: 40px;
  height: 30px;
  padding:0;
  border:none;
  background: transparent;
  cursor:pointer;
}

.palette-actions{ display:flex; justify-content:flex-end; margin-top: 10px; }

/* Main panel */
.panel{
  background: var(--glass-tint);
  border: 1px solid var(--border);
  border-radius: var(--radius-xl);
  padding: var(--space-4);

  -webkit-backdrop-filter: blur(var(--glass-blur));
  backdrop-filter: blur(var(--glass-blur));

  box-shadow: var(--shadow-3);
  transition:
    border-color var(--dur-3) ease,
    box-shadow var(--dur-3) ease,
    transform var(--dur-3) var(--ease-out),
    background var(--dur-3) ease;
}

.panel.converted{
  animation: panel-highlight 760ms var(--ease-out);
  box-shadow:
    0 46px 140px rgba(var(--accent-r,43),var(--accent-g,123),var(--accent-b,228),0.14),
    var(--shadow-3);
}

@keyframes panel-highlight{
  0%{ transform: translateY(-2px) scale(0.998); }
  35%{ transform: translateY(0) scale(1.002); }
  100%{ transform: translateY(0) scale(1); }
}

.block{ margin-bottom: 12px; }
.field-label.small{ font-size: var(--fs-13); color: var(--muted-strong); margin-bottom: 8px; }
.small{ font-size: var(--fs-13); color: var(--muted); }

/* Footer */
.site-footer{ margin-top: 6px; }
.footersmall{ font-size: var(--fs-13); color: var(--muted); margin: 8px 0 0; }
.footersmall2{ font-size: 9px; color: var(--muted); margin: 4px 0 0; }
.footersmall3{ font-size: var(--fs-13); color: var(--muted); margin: 8px 0 0; }

/* Tabs */
.tabs{
  display:flex;
  gap: 8px;
  padding: 5px;
  border-radius: 16px;
  border: 1px solid var(--border);
  background: linear-gradient(180deg, rgba(255,255,255,0.24), rgba(255,255,255,0.10));
  -webkit-backdrop-filter: blur(var(--glass-blur));
  backdrop-filter: blur(var(--glass-blur));
  box-shadow: var(--shadow-1);
  width: fit-content;
  max-width: 100%;
  overflow:auto;
  scrollbar-width: none;
  -webkit-overflow-scrolling: touch;
}

:root[data-theme="dark"] .tabs{
  background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
}

.tabs::-webkit-scrollbar{ display:none; }

.tab-btn{
  background: transparent;
  border: none;
  cursor:pointer;
  color: var(--text);

  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap: 8px;

  padding: 11px 14px;
  border-radius: 12px;
  font-weight: 780;
  font-size: var(--fs-13);

  box-shadow:none;
  transition: background var(--dur-2) ease, transform var(--dur-2) var(--ease-out), box-shadow var(--dur-2) ease;
  flex: 0 0 auto;
  white-space: nowrap;
}

@media (hover:hover) and (pointer:fine){
  .tab-btn:hover{ background: rgba(var(--accent-r,43),var(--accent-g,123),var(--accent-b,228),0.08); transform: translateY(-1px); }
}

.tab-btn.active{
  background: rgba(var(--accent-r,43),var(--accent-g,123),var(--accent-b,228),0.14);
  box-shadow: inset 0 0 0 1px rgba(var(--accent-r,43),var(--accent-g,123),var(--accent-b,228),0.22);
}

.tab-icon{ display:inline-flex; width:18px; height:18px; align-items:center; justify-content:center; opacity:0.95; }

.tab-panel[hidden]{ display:none; }
.tab-panel.active{ display:block; }

/* Fields */
.textarea-wrap{ position:relative; }
.with-counter{ padding-bottom: 40px; }
.line-count{
  position:absolute;
  right: 12px;
  bottom: 10px;
  font-size: var(--fs-12);
  color: var(--muted);
  opacity: 0.86;
  pointer-events:none;
  user-select:none;
}

textarea,
.text-input,
.select,
.hh-input{
  width:100%;
  border-radius: 16px;
  border: 1px solid var(--border);
  outline:none;
  color: var(--text);
  background: var(--field-bg);
  transition:
    border-color var(--dur-3) ease,
    box-shadow var(--dur-3) ease,
    background var(--dur-3) ease,
    transform var(--dur-2) var(--ease-out);
}

textarea{
  padding: 14px 14px;
  font-family: var(--mono);
  font-size: var(--fs-14);
  line-height: 1.55;
  resize:none;
  scrollbar-gutter: stable both-edges;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,0.20),
    inset 0 18px 42px rgba(2,8,20,0.08),
    0 14px 32px rgba(2,8,20,0.06);
}

:root[data-theme="dark"] textarea{
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,0.10),
    inset 0 20px 54px rgba(0,0,0,0.52),
    0 18px 56px rgba(0,0,0,0.40);
}

textarea::placeholder{ color: rgba(128,140,156,0.95); }
:root[data-theme="dark"] textarea::placeholder{ color: rgba(210,220,236,0.46); }

.text-input,
.select,
.hh-input{
  padding: 12px 12px;
  font-family: var(--ui);
  font-size: var(--fs-14);
  background: var(--field-bg-2);
}

/* Inputs types (avoid iOS styling inconsistencies) */
.text-input[type="date"],
.text-input[type="time"],
.text-input[type="datetime-local"]{
  -webkit-appearance:none;
  appearance:none;
}

.select{
  appearance:none;
  padding-right: 34px;
  background-image:
    linear-gradient(45deg, transparent 50%, rgba(120,132,150,0.85) 50%),
    linear-gradient(135deg, rgba(120,132,150,0.85) 50%, transparent 50%);
  background-position:
    calc(100% - 18px) calc(1em + 2px),
    calc(100% - 13px) calc(1em + 2px);
  background-size: 5px 5px;
  background-repeat:no-repeat;
}

textarea:focus,
.text-input:focus,
.select:focus,
.hh-input:focus{
  border-color: rgba(var(--accent-r,43),var(--accent-g,123),var(--accent-b,228),0.55);
  box-shadow:
    0 0 0 5px var(--ring-soft),
    0 24px 70px rgba(var(--accent-r,43),var(--accent-g,123),var(--accent-b,228),0.12);
}

/* Height constraints */
.input-block textarea{ min-height: 220px; max-height: 360px; overflow:auto; }
.output-block textarea{ min-height: 220px; max-height: 520px; overflow:auto; }
#treeUuids{ min-height: 180px; max-height: 320px; }
#treeOutput{ min-height: 220px; max-height: 520px; }

/* Controls row */
.controls-row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 12px;
  margin-top: 12px;
}

.controls-left,
.controls-right{ display:flex; align-items:center; gap: 10px; flex-wrap:wrap; }

.controls-right.controls-nowrap{ flex-wrap:nowrap; }

/* Buttons */
button{
  appearance:none;
  border:none;
  cursor:pointer;
  border-radius: 16px;

  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap: 8px;

  padding: 11px 16px;
  font-weight: 820;
  font-size: var(--fs-14);
  color: #fff;

  background: linear-gradient(180deg, rgba(var(--accent-r,43),var(--accent-g,123),var(--accent-b,228),0.98), rgba(var(--accent-r,43),var(--accent-g,123),var(--accent-b,228),0.84));
  box-shadow:
    0 18px 44px rgba(var(--accent-r,43),var(--accent-g,123),var(--accent-b,228),0.20),
    0 10px 22px rgba(2,8,20,0.12);

  transition:
    transform var(--dur-2) var(--ease-out),
    box-shadow var(--dur-2) ease,
    filter var(--dur-2) ease,
    background var(--dur-3) ease,
    border-color var(--dur-3) ease;

  flex: 0 0 auto;
}

.btn-icon{ display:inline-flex; width:18px; height:18px; align-items:center; justify-content:center; opacity:0.98; }
.btn-icon svg{ width:100%; height:100%; stroke: currentColor; fill:none; display:block; }

@media (hover:hover) and (pointer:fine){
  button:hover{
    transform: translateY(-1px);
    filter: saturate(1.05);
    box-shadow:
      0 24px 70px rgba(var(--accent-r,43),var(--accent-g,123),var(--accent-b,228),0.24),
      0 16px 30px rgba(2,8,20,0.14);
  }
}

button:active{ transform: translateY(0); }

button.ghost{
  background: linear-gradient(180deg, rgba(255,255,255,0.22), rgba(255,255,255,0.10));
  color: var(--text);
  border: 1px solid var(--border);
  box-shadow: var(--shadow-1);
  padding: 10px 14px;
}

:root[data-theme="dark"] button.ghost{
  background: linear-gradient(180deg, rgba(255,255,255,0.09), rgba(255,255,255,0.05));
}

@media (hover:hover) and (pointer:fine){
  button.ghost:hover{
    transform: translateY(-1px);
    box-shadow: var(--shadow-2);
    border-color: var(--border-strong);
  }
}

button.small{ padding: 9px 12px; font-size: var(--fs-13); border-radius: 14px; }

button.floating{ position:relative; }

/* Subtle click ripple for .btn-animate (visual only) */
.btn-animate{ position:relative; overflow:hidden; }
.btn-animate::after{
  content:"";
  position:absolute;
  inset:auto;
  width: 8px;
  height: 8px;
  border-radius: 999px;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%) scale(1);
  opacity: 0;
  background: rgba(255,255,255,0.35);
  transition: opacity var(--dur-1) ease;
  pointer-events:none;
}
.btn-animate:active::after{ opacity: 0.35; }

/* Success / copied visual states (JS adds these classes) */
button.copied,
button.copied:hover{
  background: linear-gradient(90deg,#16a34a,#10b981) !important;
  box-shadow: 0 24px 70px rgba(10,90,50,0.18) !important;
  color: #fff !important;
}

button.success,
button.success:hover{
  background: linear-gradient(90deg,#2ea37a,#0ea56a) !important;
  box-shadow: 0 24px 70px rgba(5,80,50,0.18) !important;
  color: #fff !important;
}

/* Badge (history count) */
.badge{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  height: 20px;
  min-width: 20px;
  padding: 0;
  max-width: 0;
  overflow:hidden;

  margin-left: 0;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 900;
  line-height: 20px;

  color: #fff;
  background: linear-gradient(180deg, rgba(0,0,0,0.20), rgba(0,0,0,0.10)), var(--accent-600);
  box-shadow: 0 14px 32px rgba(0,0,0,0.18);
  opacity: 0;
  transform: translateY(-1px);

  transition:
    opacity var(--dur-3) ease,
    transform var(--dur-3) var(--ease-out),
    max-width var(--dur-3) ease,
    padding var(--dur-3) ease,
    margin-left var(--dur-3) ease;
}

.badge.visible{
  opacity: 1;
  transform: translateY(0);
  max-width: 80px;
  padding: 0 8px;
  margin-left: 8px;
}

/* Tooltip */
button[data-tooltip]{ position:relative; }
button[data-tooltip]::after{
  content: attr(data-tooltip);
  position:absolute;
  left:50%;
  bottom: calc(100% + 10px);
  transform: translateX(-50%) translateY(6px);
  white-space:nowrap;
  font-size: var(--fs-12);

  padding: 7px 9px;
  border-radius: 12px;

  color: rgba(255,255,255,0.92);
  background: rgba(12,16,24,0.88);
  border: 1px solid rgba(255,255,255,0.10);
  box-shadow: 0 18px 50px rgba(0,0,0,0.40);

  opacity:0;
  pointer-events:none;
  transition: opacity var(--dur-2) ease, transform var(--dur-2) var(--ease-out);
  z-index: 30;
}

button[data-tooltip]::before{
  content:"";
  position:absolute;
  left:50%;
  bottom: calc(100% + 4px);
  transform: translateX(-50%);
  border: 7px solid transparent;
  border-top-color: rgba(12,16,24,0.88);
  opacity:0;
  pointer-events:none;
  transition: opacity var(--dur-2) ease;
  z-index: 30;
}

@media (hover:hover) and (pointer:fine){
  button[data-tooltip]:hover::after,
  button[data-tooltip]:focus::after{ opacity: 1; transform: translateX(-50%) translateY(0); }
  button[data-tooltip]:hover::before,
  button[data-tooltip]:focus::before{ opacity: 1; }
}

/* Update notice */
.update-notice{
  display:block;
  border-radius: 16px;
  padding: 12px;
  background: linear-gradient(90deg, rgba(var(--accent-r,43),var(--accent-g,123),var(--accent-b,228),0.12), rgba(255,255,255,0.06));
  border: 1px solid rgba(var(--accent-r,43),var(--accent-g,123),var(--accent-b,228),0.20);
  box-shadow: var(--shadow-1);
  color: var(--muted-strong);
  font-size: var(--fs-13);
}

.update-notice button{
  padding: 8px 12px;
  border-radius: 14px;
  font-size: var(--fs-13);
  margin-left: 10px;
}

/* Toasts */
.update-toast,
.app-toast{
  background: var(--glass-tint-2);
  border: 1px solid var(--border);
  -webkit-backdrop-filter: blur(var(--glass-blur));
  backdrop-filter: blur(var(--glass-blur));
}

.update-toast{
  position: fixed;
  right: 18px;
  bottom: 18px;
  z-index: 20000;

  display:flex;
  align-items:center;
  gap: 12px;

  padding: 12px 14px;
  border-radius: 18px;
  box-shadow: var(--shadow-3);

  min-width: 240px;
  max-width: 380px;

  transform: translateY(12px) scale(0.985);
  opacity: 0;
  pointer-events:none;
  transition: opacity var(--dur-4) ease, transform var(--dur-4) var(--ease-out);
}

.update-toast.show{ opacity:1; transform: translateY(0) scale(1); pointer-events:auto; }
.update-toast .ut-message{ font-size: var(--fs-13); color: var(--text); flex:1; }
.update-toast .ut-actions{ display:flex; gap: 8px; align-items:center; }
.update-toast .ut-btn{ padding: 10px 12px; border-radius: 14px; font-weight: 850; font-size: var(--fs-13); }
.update-toast .ut-btn.primary{ background: var(--accent); color:#fff; box-shadow: 0 18px 44px rgba(var(--accent-r,43),var(--accent-g,123),var(--accent-b,228),0.18); }
.update-toast .ut-btn.ghost{ background: transparent; border: 1px solid var(--border); color: var(--text); }

.app-toast{
  position: fixed;
  left: 50%;
  bottom: 18px;
  transform: translateX(-50%) translateY(12px) scale(0.985);
  z-index: 20010;

  padding: 10px 12px;
  border-radius: 18px;
  box-shadow: var(--shadow-2);

  opacity: 0;
  pointer-events:none;
  transition: opacity var(--dur-3) ease, transform var(--dur-3) var(--ease-out);

  max-width: min(520px, calc(100% - 24px));
  color: var(--text);
  font-size: var(--fs-13);
}

.app-toast.show{ opacity:1; transform: translateX(-50%) translateY(0) scale(1); }
.app-toast.success{ border-color: rgba(16,185,129,0.34); }
.app-toast.danger{ border-color: rgba(239,68,68,0.34); }

/* Modals */
.modal{
  display:none;
  position:fixed;
  inset:0;
  z-index: 1200;

  padding: 16px;
  background: rgba(2,6,16,0.46);

  justify-content:center;
  align-items:center;
}

.modal.animated{
  opacity:0;
  transition: opacity var(--dur-3) ease;
}

.modal.animated.show{
  display:flex;
  opacity: 1;
}

.modal-content{
  width: 720px;
  max-width: 100%;
  max-height: 86vh;

  background: var(--glass-tint-2);
  border: 1px solid var(--border);
  border-radius: 20px;

  padding: 16px;
  overflow:hidden;
  display:flex;
  flex-direction:column;

  -webkit-backdrop-filter: blur(var(--glass-blur));
  backdrop-filter: blur(var(--glass-blur));

  box-shadow: var(--shadow-3);

  transform: translateY(8px) scale(0.99);
  transition: transform var(--dur-3) var(--ease-out);
}

.modal.animated.show .modal-content{ transform: translateY(0) scale(1); }

.modal-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 12px;
  margin-bottom: 10px;
}

.modal-header h2{
  margin:0;
  font-size: var(--fs-18);
  font-weight: 900;
  letter-spacing: -0.012em;
}

.modal-actions{ display:flex; gap: 8px; align-items:center; flex-wrap:wrap; }

.modal-content .close{
  background: transparent;
  border:none;
  font-size: 22px;
  line-height: 1;
  cursor:pointer;
  padding: 8px 10px;
  border-radius: 14px;
  color: var(--text);
  box-shadow:none;
}

@media (hover:hover) and (pointer:fine){
  .modal-content .close:hover{ background: rgba(255,255,255,0.12); }
  :root[data-theme="dark"] .modal-content .close:hover{ background: rgba(255,255,255,0.08); }
}

.hotkeys-list{ margin: 10px 0 0; padding-left: 18px; }
.tiny{ font-size: var(--fs-12); color: var(--muted); margin-top: 8px; }
.muted-hint{ opacity: 0.92; }

/* History */
.history-list{
  flex:1;
  overflow:auto;
  padding: 10px;
  border-radius: 16px;

  background: rgba(255,255,255,0.10);
  border: 1px solid var(--divider);
  box-shadow: inset 0 14px 40px rgba(0,0,0,0.06);
  scrollbar-gutter: stable both-edges;
}

:root[data-theme="dark"] .history-list{
  background: rgba(255,255,255,0.04);
  box-shadow: inset 0 16px 46px rgba(0,0,0,0.52);
}

.history-item{
  border-radius: 16px;
  overflow:hidden;
  border: 1px solid var(--divider);
  background: var(--glass-tint-3);
  box-shadow: var(--shadow-1);
  margin-bottom: 10px;
}

.history-header{
  cursor:pointer;
  padding: 12px 14px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 12px;

  background: linear-gradient(180deg, rgba(255,255,255,0.14), rgba(255,255,255,0.06));
  border-bottom: 1px solid var(--divider);
}

:root[data-theme="dark"] .history-header{
  background: linear-gradient(180deg, rgba(255,255,255,0.07), rgba(255,255,255,0.03));
}

.hh-left{ display:flex; flex-direction:column; gap: 3px; min-width:0; }
.hh-name{ font-weight: 900; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width: 420px; }
.hh-time{ font-size: var(--fs-12); color: var(--muted); font-weight: 650; }

.hh-actions{
  display:flex;
  gap: 8px;
  align-items:center;
  flex: 0 0 auto;
  flex-wrap:wrap;
  justify-content:flex-end;
}

.hh-btn.small{ padding: 8px 12px; border-radius: 14px; font-size: var(--fs-12); }

.hh-btn.danger{ border-color: rgba(239,68,68,0.38); color: #ef4444; }

@media (hover:hover) and (pointer:fine){
  .hh-btn.danger:hover{ background: rgba(239,68,68,0.08); }
}

/* inline rename */
.hh-edit{ display:flex; flex:1; gap: 8px; align-items:center; min-width:0; }
.hh-input{ min-width: 160px; }

.history-body{
  max-height: 0;
  overflow:hidden;
  padding: 0 12px;
  background: rgba(255,255,255,0.04);
  transition: max-height var(--dur-4) ease, padding var(--dur-3) ease;
}

.history-body.open{
  padding: 12px;
  overflow:auto;
}

.history-body pre{
  margin:0;
  padding: 10px;
  border-radius: 14px;
  background: rgba(0,0,0,0.02);
  border: 1px solid var(--divider);
  white-space: pre-wrap;
  word-break: break-word;
  max-height: 260px;
  overflow:auto;
  font-family: var(--mono);
  font-size: var(--fs-13);
}

:root[data-theme="dark"] .history-body pre{
  background: rgba(0,0,0,0.26);
}

/* Quick row */
.quick-row{
  display:flex;
  gap: 10px;
  flex-wrap:wrap;
  margin: 0 0 12px 0;
}

/* Grid */
.grid-2{ display:grid; grid-template-columns: 1fr 1fr; gap: 12px; }

/* Loader */
#loader{
  position:fixed;
  inset:0;
  z-index: 9999;

  display:flex;
  align-items:center;
  justify-content:center;

  background: var(--bg);
  transition: opacity var(--dur-4) ease;
}

#loader.hidden{ opacity:0; pointer-events:none; }

.dots-container{ display:flex; align-items:center; justify-content:center; width:100%; height:100%; }
.dot{
  width: 18px;
  height: 18px;
  margin-right: 10px;
  border-radius: 999px;
  background-color: rgba(var(--accent-r,43),var(--accent-g,123),var(--accent-b,228),0.26);
  animation: pulse 1.35s infinite ease-in-out;
  box-shadow: 0 10px 28px rgba(0,0,0,0.12);
}
.dot:last-child{ margin-right:0; }
.dot:nth-child(1){ animation-delay: -0.30s; }
.dot:nth-child(2){ animation-delay: -0.12s; }
.dot:nth-child(3){ animation-delay: 0.06s; }

@keyframes pulse{
  0%{ transform: scale(0.92); opacity: 0.85; }
  50%{ transform: scale(1.14); opacity: 1; }
  100%{ transform: scale(0.92); opacity: 0.85; }
}

/* Scrollbars */
textarea::-webkit-scrollbar,
.history-list::-webkit-scrollbar,
.history-body::-webkit-scrollbar{ width: 10px; height: 10px; }

textarea::-webkit-scrollbar-track,
.history-list::-webkit-scrollbar-track,
.history-body::-webkit-scrollbar-track{ background: var(--scroll-track); border-radius: 999px; }

textarea::-webkit-scrollbar-thumb,
.history-list::-webkit-scrollbar-thumb,
.history-body::-webkit-scrollbar-thumb{
  background: var(--scroll-thumb);
  border-radius: 999px;
  border: 2px solid transparent;
  background-clip: padding-box;
}

textarea::-webkit-scrollbar-thumb:hover,
.history-list::-webkit-scrollbar-thumb:hover,
.history-body::-webkit-scrollbar-thumb:hover{ background: var(--scroll-thumb-hover); }

textarea, .history-list, .history-body{ scrollbar-width: thin; scrollbar-color: var(--scroll-thumb) var(--scroll-track); }

/* Responsive upgrades */
@media (min-width: 721px){
  body{
    padding: 22px;
    font-size: var(--fs-15);
  }
  .app-shell{ gap: 14px; }
  .panel{ padding: 20px; }
}

@media (max-width: 920px){
  .panel{ padding: 16px; border-radius: 20px; }
  .hh-name{ max-width: 260px; }
  .update-toast{ left: 12px; right: 12px; max-width: calc(100% - 24px); }
}

@media (max-width: 720px){
  body{ font-size: var(--fs-14); }

  /* iOS: prevent input zoom */
  textarea, .text-input, .select{ font-size: 16px; }

  .site-header{ flex-direction:column; align-items:stretch; }
  .header-controls{ justify-content:flex-end; }

  .controls-row{ flex-direction:column; align-items:stretch; }
  .controls-left, .controls-right{ width:100%; }
  .controls-right.controls-nowrap{ flex-wrap:wrap; }
  .controls-row button{ width:100%; }

  .tabs{ width: 100%; }

  .grid-2{ grid-template-columns: 1fr; }

  /* Palette popover stays in viewport */
  .palette-popover{
    position: fixed;
    left: 12px;
    right: 12px;
    top: calc(68px + env(safe-area-inset-top));
    margin-top: 0;
  }

  /* Modals become bottom-sheet-ish for one-hand comfort */
  .modal{ align-items:flex-end; padding: 12px; }
  .modal-content{
    width: 100%;
    max-height: min(88vh, calc(100vh - 24px - env(safe-area-inset-top) - env(safe-area-inset-bottom)));
    border-radius: 22px 22px 0 0;
    transform: translateY(16px) scale(1);
  }
  .modal.animated.show .modal-content{ transform: translateY(0) scale(1); }

  .history-header{ flex-wrap:wrap; }
  .hh-actions{ width:100%; justify-content:flex-end; }
}

@media (max-width: 480px){
  .title{ font-size: 18px; }
  .panel{ padding: 14px; }
  textarea{ padding: 12px; }
  .tab-icon{ display:none; }
  .hh-name{ max-width: 180px; }
}

/* Touch targets */
@media (hover:none) and (pointer:coarse){
  button, .icon-btn, .text-input, .select{ min-height: 44px; }
  button{ touch-action: manipulation; }
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce){
  *, *::before, *::after{
    animation-duration: 1ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 1ms !important;
    scroll-behavior: auto !important;
  }
}


/* =========================================
   PREMIUM OVERRIDES + FIX: palette popover layering
   UI-only, no logic changes
   ========================================= */

/* Fix stacking: backdrop-filter creates stacking contexts; keep header/popovers above the main panel */
.site-header{
  position: relative;
  z-index: 50;
}

.header-controls{
  position: relative;
  z-index: 55;
}

.palette-control{
  position: relative;
  z-index: 60;
}

.panel{
  position: relative;
  z-index: 1;
}

.palette-popover{
  z-index: 9999;
  isolation: isolate;
}

/* Premium glass header bar */
.site-header{
  padding: 10px 12px;
  border-radius: 18px;
  background: linear-gradient(180deg, rgba(255,255,255,0.52), rgba(255,255,255,0.22));
  border: 1px solid rgba(255,255,255,0.18);
  -webkit-backdrop-filter: blur(var(--glass-blur));
  backdrop-filter: blur(var(--glass-blur));
  box-shadow: var(--shadow-1);
}

:root[data-theme="dark"] .site-header{
  background: linear-gradient(180deg, rgba(255,255,255,0.09), rgba(255,255,255,0.04));
  border-color: rgba(255,255,255,0.12);
}

/* Premium palette popover */
.palette-popover{
  border-radius: 18px;
  background:
    radial-gradient(900px 280px at 22% 0%, rgba(255,255,255,0.24), transparent 55%),
    linear-gradient(180deg, rgba(255,255,255,0.72), rgba(255,255,255,0.56));
  border: 1px solid rgba(255,255,255,0.20);
  box-shadow: 0 26px 90px rgba(6,10,14,0.20), var(--shadow-2);
}

:root[data-theme="dark"] .palette-popover{
  background:
    radial-gradient(900px 280px at 22% 0%, rgba(255,255,255,0.12), transparent 55%),
    linear-gradient(180deg, rgba(24,28,36,0.82), rgba(24,28,36,0.62));
  border-color: rgba(255,255,255,0.12);
}

/* Premium depth for the main panel */
.panel::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius: inherit;
  pointer-events:none;
  z-index: 0;
  background:
    radial-gradient(1200px 420px at 14% -10%, rgba(255,255,255,0.46), transparent 56%),
    radial-gradient(900px 360px at 110% 0%, rgba(var(--accent-r,43),var(--accent-g,123),var(--accent-b,228),0.14), transparent 62%);
  opacity: 0.85;
  mix-blend-mode: overlay;
}

:root[data-theme="dark"] .panel::before{
  opacity: 0.58;
  background:
    radial-gradient(1200px 420px at 14% -10%, rgba(255,255,255,0.18), transparent 56%),
    radial-gradient(900px 360px at 110% 0%, rgba(var(--accent-r,43),var(--accent-g,123),var(--accent-b,228),0.12), transparent 62%);
}

.panel > *{
  position: relative;
  z-index: 1;
}

/* Premium sheen for primary buttons */
button:not(.ghost){
  position: relative;
  overflow: hidden;
}

button:not(.ghost)::before{
  content:"";
  position:absolute;
  inset:-1px;
  background: radial-gradient(700px 220px at 30% 0%, rgba(255,255,255,0.46), transparent 56%);
  opacity: 0.55;
  pointer-events:none;
  transform: translateY(-2px);
  transition: opacity var(--dur-2) ease, transform var(--dur-2) var(--ease-out);
}

@media (hover:hover) and (pointer:fine){
  button:not(.ghost):hover::before{
    opacity: 0.78;
    transform: translateY(0);
  }
}

/* Tabs: a touch more premium */
.tabs{
  border-color: rgba(255,255,255,0.18);
  box-shadow: 0 12px 30px rgba(2,8,20,0.08);
}

:root[data-theme="dark"] .tabs{
  border-color: rgba(255,255,255,0.12);
}
